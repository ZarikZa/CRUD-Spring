<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Магазин унитазов</title>
    <style>
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .filters { background: #f5f5f5; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
        .filter-group { margin-bottom: 10px; display: inline-block; margin-right: 15px; }
        .pagination { margin: 20px 0; }
        .toilet-card { border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 5px; }
        .actions { margin-top: 10px; }
        .btn { padding: 5px 10px; margin: 2px; text-decoration: none; border-radius: 3px; display: inline-block; }
        .btn-primary { background: #007bff; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .search-box { margin-bottom: 15px; }
        .navigation { margin-bottom: 20px; }
        .pagination a { margin: 0 5px; padding: 5px 10px; border: 1px solid #ddd; text-decoration: none; }
        .pagination strong { margin: 0 5px; padding: 5px 10px; background: #007bff; color: white; }
    </style>
</head>
<body>
<div class="container">
    <h1>Магазин унитазов</h1>

    <div class="navigation">
        <a th:href="@{/toilets/add}" class="btn btn-primary">Добавить унитаз</a>
        <a th:href="@{/toilets/multiple-delete}" class="btn btn-danger">Множественное удаление</a>
        <a th:href="@{/toilets/multiple-soft-delete}" class="btn btn-warning">Множественное логическое удаление</a>
    </div>

    <div class="search-box">
        <form method="get" th:action="@{/toilets}">
            <input type="text" name="search" th:value="${searchTerm}" placeholder="Поиск по названию, бренду, модели...">
            <button type="submit">Найти</button>
            <a th:href="@{/toilets}">Сбросить поиск</a>
        </form>
    </div>

    <div class="filters">
        <h3>Фильтры</h3>
        <form method="get" th:action="@{/toilets}">
            <input type="hidden" name="search" th:value="${searchTerm}">

            <div class="filter-group">
                <label>Бренд:</label>
                <select name="brand">
                    <option value="">Все бренды</option>
                    <option th:each="brand : ${brands}"
                            th:value="${brand}"
                            th:text="${brand}"
                            th:selected="${filterBrand == brand}"></option>
                </select>
            </div>

            <div class="filter-group">
                <label>Макс. цена:</label>
                <input type="number" name="maxPrice" th:value="${filterMaxPrice}" placeholder="Максимальная цена" step="1000">
            </div>

            <div class="filter-group">
                <label>Категория:</label>
                <select name="categoryName">
                    <option value="">Все категории</option>
                    <option th:each="category : ${categories}"
                            th:value="${category.name}"
                            th:text="${category.name}"
                            th:selected="${filterCategory == category.name}"></option>
                </select>
            </div>

            <div class="filter-group">
                <button type="submit">Применить фильтры</button>
                <a th:href="@{/toilets}">Сбросить фильтры</a>
            </div>
        </form>
    </div>

    <div class="pagination" th:if="${totalPages > 1}">
        <span>Страница [[${currentPage}]] из [[${totalPages}]] (Всего: [[${totalCount}]])</span>
        <div>
            <a th:if="${currentPage > 1}"
               th:href="@{/toilets(page=${currentPage - 1}, size=${pageSize}, search=${searchTerm}, brand=${filterBrand}, maxPrice=${filterMaxPrice}, categoryName=${filterCategory})}">
                ← Предыдущая
            </a>

            <span th:each="i : ${#numbers.sequence(1, totalPages)}">
                    <a th:if="${i != currentPage}"
                       th:href="@{/toilets(page=${i}, size=${pageSize}, search=${searchTerm}, brand=${filterBrand}, maxPrice=${filterMaxPrice}, categoryName=${filterCategory})}"
                       th:text="${i}">
                    </a>
                    <strong th:if="${i == currentPage}" th:text="${i}"></strong>
                </span>

            <a th:if="${currentPage < totalPages}"
               th:href="@{/toilets(page=${currentPage + 1}, size=${pageSize}, search=${searchTerm}, brand=${filterBrand}, maxPrice=${filterMaxPrice}, categoryName=${filterCategory})}">
                Следующая →
            </a>
        </div>
    </div>

    <div th:if="${searchTerm != null && !searchTerm.isEmpty() || filterBrand != null && !filterBrand.isEmpty() || filterMaxPrice != null || filterCategory != null && !filterCategory.isEmpty()}">
        <p>
            <strong>Примененные фильтры:</strong>
            <span th:if="${searchTerm != null && !searchTerm.isEmpty()}">Поиск: "[[${searchTerm}]]" </span>
            <span th:if="${filterBrand != null && !filterBrand.isEmpty()}">Бренд: [[${filterBrand}]] </span>
            <span th:if="${filterMaxPrice != null}">Макс. цена: [[${#numbers.formatDecimal(filterMaxPrice, 1, 2)}]] руб. </span>
            <span th:if="${filterCategory != null && !filterCategory.isEmpty()}">Категория: [[${filterCategory}]]</span>
            <a th:href="@{/toilets}">[Сбросить все]</a>
        </p>
    </div>

    <div>
        <div th:if="${totalCount == 0}">
            <p>Унитазы не найдены.</p>
        </div>

        <div th:each="toilet : ${toilets}" class="toilet-card">
            <h4 th:text="${toilet.name}"></h4>
            <p><strong>Бренд:</strong> [[${toilet.brand}]]</p>
            <p><strong>Модель:</strong> [[${toilet.model}]]</p>
            <p><strong>Цвет:</strong> [[${toilet.color}]]</p>
            <p><strong>Цена:</strong> [[${#numbers.formatDecimal(toilet.price, 1, 2)}]] руб.</p>
            <p><strong>В наличии:</strong> [[${toilet.stockQuantity}]] шт.</p>
            <p><strong>Материал:</strong> [[${toilet.material}]]</p>
            <p><strong>Категория:</strong>
                <span th:if="${toilet.category != null}" th:text="${toilet.category.name}"></span>
                <span th:if="${toilet.category == null}">Не указана</span>
            </p>
            <p><strong>Водосберегающий:</strong> [[${toilet.waterSaving} ? 'Да' : 'Нет']]</p>

            <div class="actions">
                <a th:href="@{/toilets/edit/{id}(id=${toilet.id})}" class="btn btn-primary">Редактировать</a>
                <a th:href="@{/toilets/delete/{id}(id=${toilet.id})}" class="btn btn-danger">Удалить</a>
                <a th:href="@{/toilets/soft-delete/{id}(id=${toilet.id})}" class="btn btn-warning">Логическое удаление</a>
            </div>
        </div>
    </div>

    <div class="pagination" th:if="${totalPages > 1}">
        <span>Страница [[${currentPage}]] из [[${totalPages}]] (Всего: [[${totalCount}]])</span>
        <div>
            <a th:if="${currentPage > 1}"
               th:href="@{/toilets(page=${currentPage - 1}, size=${pageSize}, search=${searchTerm}, brand=${filterBrand}, maxPrice=${filterMaxPrice}, categoryName=${filterCategory})}">
                ← Предыдущая
            </a>

            <span th:each="i : ${#numbers.sequence(1, totalPages)}">
                    <a th:if="${i != currentPage}"
                       th:href="@{/toilets(page=${i}, size=${pageSize}, search=${searchTerm}, brand=${filterBrand}, maxPrice=${filterMaxPrice}, categoryName=${filterCategory})}"
                       th:text="${i}">
                    </a>
                    <strong th:if="${i == currentPage}" th:text="${i}"></strong>
                </span>

            <a th:if="${currentPage < totalPages}"
               th:href="@{/toilets(page=${currentPage + 1}, size=${pageSize}, search=${searchTerm}, brand=${filterBrand}, maxPrice=${filterMaxPrice}, categoryName=${filterCategory})}">
                Следующая →
            </a>
        </div>
    </div>
</div>
</body>
</html>